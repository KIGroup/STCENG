<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="Stc.DeepSee.FeedBackCube.Fact">
<Description><![CDATA[
Fact table for cube 'FeedBackCube'.<br/>
THIS IS A GENERATED CLASS, DO NOT EDIT.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.]]></Description>
<Final>1</Final>
<IncludeCode>%DeepSee</IncludeCode>
<Owner/>
<ProcedureBlock>1</ProcedureBlock>
<Super>%DeepSee.FactTable,%DeepSee.CubeFunctionSet</Super>
<TimeCreated>63744,85803.856459</TimeCreated>
<GeneratedBy>Stc.DeepSee.FeedBackCube.CLS</GeneratedBy>
<Inheritance>right</Inheritance>

<Parameter name="BITMAPCHUNKINMEMORY">
<Default>0</Default>
</Parameter>

<Parameter name="CUBENAME">
<Default>FeedBackCube</Default>
</Parameter>

<Parameter name="SOURCECLASS">
<Default>Stc.Data.FeedBack</Default>
</Parameter>

<Index name="DxCourseViaTraining">
<Description>
Index for fact 2.</Description>
<Type>bitmap</Type>
<Properties>DxCourseViaTraining</Properties>
</Index>

<Index name="DxTeacherViaTraining">
<Description>
Index for fact 3.</Description>
<Type>bitmap</Type>
<Properties>DxTeacherViaTraining</Properties>
</Index>

<Index name="MxRating">
<Description>
Index for measure M1.</Description>
<Type>bitslice</Type>
<Properties>MxRating</Properties>
</Index>

<Property name="%sourceId">
<Description>
Reference to original data in source table.</Description>
<Type>Stc.Data.FeedBack</Type>
</Property>

<Property name="%partition">
<Description>
This indicates which partition (set of 1M) this fact is in.</Description>
<Type>%Integer</Type>
<Calculated>1</Calculated>
<SqlComputeCode>Set {%partition}=({ID}\1024000)+1</SqlComputeCode>
<SqlComputed>1</SqlComputed>
</Property>

<Property name="DxCourseViaTraining">
<Description><![CDATA[
Измерение : DxCourseViaTraining<br/>
Источник: Training.Course]]></Description>
<Type>Stc.DeepSee.FeedBackCube.StarCourseViaTraining</Type>
</Property>

<Property name="DxTeacherViaTraining">
<Description><![CDATA[
Измерение : DxTeacherViaTraining<br/>
Источник: Training.Teacher]]></Description>
<Type>Stc.DeepSee.FeedBackCube.StarTeacherViaTraining</Type>
</Property>

<Property name="MxRating">
<Description><![CDATA[
Показатель: MxRating<br/>
Источник: Rating]]></Description>
<Type>%Integer</Type>
<Parameter name="MAXVAL" value="5"/>
<Parameter name="MINVAL" value="1"/>
</Property>

<Method name="%Count">
<Description><![CDATA[
Return the total number of items within the Fact table.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.]]></Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Integer</ReturnType>
<Implementation><![CDATA[
 Set tCount = 0
 &sql(SELECT COUNT(*) INTO :tCount FROM Stc_DeepSee_FeedBackCube.Fact)
 Quit tCount
]]></Implementation>
</Method>

<Method name="%UpdateFacts">
<Description><![CDATA[
Update a range of Facts with data from the source table row with ids from <var>pStartId</var> to <var>pEndId</var>.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[pStartId:%String,pEndId:%String,pBatchMode:%Boolean=0,&pChunks:%Integer,pVerbose:%Boolean=0,pTaskGroup:%String="",*pUpdates:%Integer,pRefProp:%String="",pRefID:%String="",&pDimTables]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 Set tSC = $$$OK
 Set tRS = ""
 New %var,%source,%ROWID,%msg,%dsSourceId,%dsSourceObj
 Try {
 Set (SQLCODE,tStarId) = ""
 Set pUpdates = 0
 Set tLastCount = 0
 Set tID = ""
 Set tRows = 0
 If (pEndId="") {
  Set:+$G(%dsReadCommitted,1) oldzu=$ZU(115,2,1)
  Set pEndId=pStartId
 }
 If (pRefProp'="") {
  Set tRS = ##class(%ResultSet).%New()
  Set tSC = tRS.Prepare("SELECT %ID,Rating ""MxRating"",Training->Course->Name->Value ""Dx2997266354"",%EXTERNAL(Training->Course) ""DxCourseViaTraining"",Training->Teacher->LastName->Value ""Dx1346869160"",%EXTERNAL(Training->Teacher) ""DxTeacherViaTraining"" FROM Stc_Data.FeedBack"_" WHERE "_pRefProp_"=?")
  If $$$ISERR(tSC) Quit
  Set tSC = tRS.Execute(pRefID)
  If $$$ISERR(tSC) Quit
 }
 ElseIf (pStartId=pEndId) {
  &sql(DECLARE sqeq2497058047 CURSOR FOR
  SELECT %ID,Rating "MxRating",Training->Course->Name->Value "Dx2997266354",%EXTERNAL(Training->Course) "DxCourseViaTraining",Training->Teacher->LastName->Value "Dx1346869160",%EXTERNAL(Training->Teacher) "DxTeacherViaTraining" FROM Stc_Data.FeedBack
  WHERE %ID = :pStartId
  )
  &sql(OPEN sqeq2497058047)
  If (SQLCODE'=0) {
   Set tSC = $$$ERROR($$$GeneralError,"Error opening SQL cursor: ("_$G(SQLCODE)_") "_$G(%msg))
   Quit
  }
  &sql(FETCH sqeq2497058047 INTO :tID,:%var("MxRating"),:%var("Dx2997266354"),:%var("DxCourseViaTraining"),:%var("Dx1346869160"),:%var("DxTeacherViaTraining"))
 }
 Else {
  &sql(DECLARE sq2497058047 CURSOR FOR
  SELECT %ID,Rating "MxRating",Training->Course->Name->Value "Dx2997266354",%EXTERNAL(Training->Course) "DxCourseViaTraining",Training->Teacher->LastName->Value "Dx1346869160",%EXTERNAL(Training->Teacher) "DxTeacherViaTraining" FROM Stc_Data.FeedBack
  WHERE %ID BETWEEN :pStartId  AND :pEndId
  )
  &sql(OPEN sq2497058047)
  If (SQLCODE'=0) {
   Set tSC = $$$ERROR($$$GeneralError,"Error opening SQL cursor: ("_$G(SQLCODE)_") "_$G(%msg))
   Quit
  }
  &sql(FETCH sq2497058047 INTO :tID,:%var("MxRating"),:%var("Dx2997266354"),:%var("DxCourseViaTraining"),:%var("Dx1346869160"),:%var("DxTeacherViaTraining"))
 }
 While ($S($IsObject(tRS):tRS.Next(.tSC),1:SQLCODE=0)) {
 Try {
 If ($IsObject(tRS)) {
  If $$$ISERR(tSC) Quit
  Set tID = $G(tRS.Data("%ID"))
  Set %var("MxRating") = $G(tRS.Data("MxRating"))
  Set %var("Dx2997266354") = $G(tRS.Data("Dx2997266354"))
  Set %var("DxCourseViaTraining") = $G(tRS.Data("DxCourseViaTraining"))
  Set %var("Dx1346869160") = $G(tRS.Data("Dx1346869160"))
  Set %var("DxTeacherViaTraining") = $G(tRS.Data("DxTeacherViaTraining"))
 }
 Set %dsSourceId = $G(tID)
 Set:pBatchMode tExStartTime = $ZH
 Set:pBatchMode x = $I(^CacheTemp.DeepSeeBuildStats($ZU(5),"FEEDBACKCUBE","expr"),$ZH-tExStartTime)

 #; invoke method to process this fact
 Set tFactId = ""
 Set tSC = ##class(Stc.DeepSee.FeedBackCube.Fact).%ProcessFact(tID,pBatchMode,.%var,.tFactId,.tErrorMsg,.pDimTables)
 If (tFactId'="") {
 If $$$ISOK(tSC) {
  Set pUpdates = pUpdates+1
  Set pChunks(tFactId\64000+1) = ""
 }
 ElseIf (pVerbose) {
  Write "Error filing row: ",tID,!
  Write:tErrorMsg'="" tErrorMsg,!
  Do $System.Status.DisplayError(tSC)
  Set tSC = $$$OK
 }
 Kill pDimTables
 Set tRows = tRows + 1
 If (pVerbose&&'(tRows#1000)) Write $C(13,27)_"[0J"_"Building fact table: ",?25,$J($FN(tRows,",",0),10)," fact(s) updated."
 If (pVerbose&&'(tRows#1000)&&(+$G(%dserrcount))) Write " ",$J($FN(%dserrcount,",",0),10)," error(s)"
 If ((pTaskGroup'="")&&'(tRows#1000)) {
  Set tDelta = tRows - tLastCount
  Set inc=$I(^CacheTemp.DeepSeeUpdate($ZU(5),pTaskGroup,"facts"),tDelta)
  Set tLastCount = tRows
 }
 } ;factId
  }
  Catch (ex) {
    Set tSC = ex.AsStatus()
    If ($G(tID)'="") {
      S:($G($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",tID))="") x = $I($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE"))
      Set $$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",tID) = tSC
    }
  }
  If '$IsObject(tRS) {
   If (pStartId=pEndId) {
    &sql(FETCH sqeq2497058047 INTO :tID,:%var("MxRating"),:%var("Dx2997266354"),:%var("DxCourseViaTraining"),:%var("Dx1346869160"),:%var("DxTeacherViaTraining"))
   }
   Else {
    &sql(FETCH sq2497058047 INTO :tID,:%var("MxRating"),:%var("Dx2997266354"),:%var("DxCourseViaTraining"),:%var("Dx1346869160"),:%var("DxTeacherViaTraining"))
   }
  }
 } ;while
  If '$IsObject(tRS) {
   If (pStartId=pEndId) {
    &sql(CLOSE sqeq2497058047)
   }
   Else {
    &sql(CLOSE sq2497058047)
   }
  }
 If (pVerbose) Write $C(13,27)_"[0J"_"Building fact table: "_$FN(+$G(tRows),",",0)_" fact(s) updated"
 If (pTaskGroup'="") {
  Set tDelta = tRows - tLastCount
  Set inc=$I(^CacheTemp.DeepSeeUpdate($ZU(5),pTaskGroup,"facts"),tDelta)
 }
 }
 Catch(ex) {
  Set tSC = ex.AsStatus()
  &sql(CLOSE sqeq2497058047)
  &sql(CLOSE sq2497058047)
 }
  Set:$D(oldzu) zu=$ZU(115,2,oldzu)
 If ($$$ISERR(tSC)) {
  Do ..%LogError(tSC)
  If (pVerbose) {
   Do $System.Status.DisplayError(tSC)
  }
  If ($G(tID)'="") {
   S:($G($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",tID))="") x = $I($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE"))
   Set $$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",tID) = tSC
  }
 }
 Quit tSC
]]></Implementation>
</Method>

<Method name="%BuildAllFacts">
<Description><![CDATA[
Update all Facts with data from the source table.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pVerbose:%Boolean=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 Set tSC = $$$OK
 New %var,%source,%ROWID,%msg,%dsSourceId,%dsSourceObj
 Try {
 Set (SQLCODE,tStarId) = ""
 Set tLastCount = 0
 Set tID = ""
 Set tRows = 0
  &sql(DECLARE sq22497058047 CURSOR FOR
  SELECT %ID,Rating "MxRating",Training->Course->Name->Value "Dx2997266354",%EXTERNAL(Training->Course) "DxCourseViaTraining",Training->Teacher->LastName->Value "Dx1346869160",%EXTERNAL(Training->Teacher) "DxTeacherViaTraining" FROM Stc_Data.FeedBack
  )
  &sql(OPEN sq22497058047)
  If (SQLCODE'=0) {
   Set tSC = $$$ERROR($$$GeneralError,"Error opening SQL cursor: ("_$G(SQLCODE)_") "_$G(%msg))
   Quit
  }
  &sql(FETCH sq22497058047 INTO :tID,:%var("MxRating"),:%var("Dx2997266354"),:%var("DxCourseViaTraining"),:%var("Dx1346869160"),:%var("DxTeacherViaTraining"))
  If ((SQLCODE=100)&&pVerbose) {
   Write "No source data found.",!
  }
  While (SQLCODE=0) {
  If ($D(%dsmaxfacts)&&(tRows>=+$G(%dsmaxfacts))) Quit
  Try {
 Set %dsSourceId = $G(tID)
 Set tExStartTime = $ZH
 Set x = $I(^CacheTemp.DeepSeeBuildStats($ZU(5),"FEEDBACKCUBE","expr"),$ZH-tExStartTime)

 #; invoke method to process this fact
 Set tFactId = ""
 Set tSC = ##class(Stc.DeepSee.FeedBackCube.Fact).%ProcessFact(tID,1,.%var,.tFactId,.tErrorMsg)
 Set:$$$ISERR(tSC) err = $I(%dserrcount)
 If ($$$ISERR(tSC)&&pVerbose) {
  Write "Error filing row: ",tID,!
  Write:tErrorMsg'="" tErrorMsg,!
  Do $System.Status.DisplayError(tSC)
  Set tSC = $$$OK
 }
 If (tFactId'="") {
  Set tRows = tRows + 1
  Set:pVerbose %dsfactcount = tRows
  If (pVerbose&&'(tRows#1000)) Write $C(13,27)_"[0J"_"Building fact table: ",?25,$J($FN(tRows,",",0),10)," fact(s) updated."
  If (pVerbose&&'(tRows#1000)&&(+$G(%dserrcount))) Write " ",$J($FN(%dserrcount,",",0),10)," error(s)"
 } ;factId
  }
  Catch (ex) {
    Set tSC = ex.AsStatus()
    If ($G(tID)'="") {
      S:($G($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",tID))="") x = $I($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE"))
      Set $$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",tID) = tSC
    }
  }
  &sql(FETCH sq22497058047 INTO :tID,:%var("MxRating"),:%var("Dx2997266354"),:%var("DxCourseViaTraining"),:%var("Dx1346869160"),:%var("DxTeacherViaTraining"))
 } ;while
  &sql(CLOSE sq22497058047)
 If (pVerbose) Write $C(13,27)_"[0J"_"Building fact table: "_$FN(+$G(tRows),",",0)_" fact(s) updated"
 }
 Catch(ex) {
  Set tSC = ex.AsStatus()
  &sql(CLOSE sq22497058047)
 }
 If ($$$ISERR(tSC)) {
  Do ..%LogError(tSC)
  If (pVerbose) {
   Do $System.Status.DisplayError(tSC)
  }
  If ($G(tID)'="") {
   S:($G($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",tID))="") x = $I($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE"))
   Set $$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",tID) = tSC
  }
 }
 Quit tSC
]]></Implementation>
</Method>

<Method name="%BuildTempFile">
<Description><![CDATA[
Create a temp file of all source ids.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pTempKey:%String,*pImplemented:%Boolean,pVerbose:%Boolean=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 Set tSC = $$$OK
 New %var,%source,%ROWID,%msg,%dsSourceId,%dsSourceObj
 Set pImplemented = 1
 Try {
 Set (SQLCODE,tStarId) = ""
 Kill ^CacheTemp.DeepSeeSourceId(pTempKey)
 Set tID = ""
 Set tRows = 0
  &sql(DECLARE sq32497058047 CURSOR FOR
  SELECT %ID FROM Stc_Data.FeedBack
  )
  &sql(OPEN sq32497058047)
  If (SQLCODE'=0) {
   Set tSC = $$$ERROR($$$GeneralError,"Error opening SQL cursor: ("_$G(SQLCODE)_") "_$G(%msg))
   Quit
  }
  &sql(FETCH sq32497058047 INTO :tID)
  If ((SQLCODE=100)&&pVerbose) {
   Write "No source data found.",!
  }
  While (SQLCODE=0) {
  Set tRows = tRows+1
  Set tChunk = tRows\64000+1
  Set tOffset = tRows#64000+1
  Set:tID'="" ^CacheTemp.DeepSeeSourceId(pTempKey,tChunk,tOffset) = tID
  If (pVerbose&&'(tRows#10000)) Write $C(13,27)_"[0J"_"Building temp file: ",?25,$J($FN(tRows,",",0),10)," record(s) processed."
  If ($D(%dsmaxfacts)&&(tRows>=+$G(%dsmaxfacts))) Quit
  &sql(FETCH sq32497058047 INTO :tID)
 } ;while
  &sql(CLOSE sq32497058047)
 If (pVerbose) Write $C(13,27)_"[0J"_"Building temp file: "_$FN(+$G(tRows),",",0)_" record(s) processed"
 }
 Catch(ex) {
  Set tSC = ex.AsStatus()
  &sql(CLOSE sq32497058047)
 }
 If ($$$ISERR(tSC)) {
  Do ..%LogError(tSC)
  If (pVerbose) {
   Do $System.Status.DisplayError(tSC)
  }
 }
 Quit tSC
]]></Implementation>
</Method>

<Method name="%ProcessFact">
<Description><![CDATA[
Perform the work of updating one fact in the cube.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[pID:%String,pBatchMode:%Boolean=0,&%var:%String,&pFactId:%Integer,*pErrorMsg:%String,&pDimTables,pDimensionsOnly:%Boolean=0]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 Set tSC = $$$OK
 New %ROWID,%msg,%value,%source,%expression
 Try {
  Set (SQLCODE,tStarId) = ""
  Set pErrorMsg = ""
  Set pFactId = $G(pFactId)
  Set %value = ""

  #; apply null replacements
  Set:(($G(%var("DxCourseViaTraining"))="")||($G(%var("DxCourseViaTraining"))=$C(0))) %var("DxCourseViaTraining") = "<null>"
  Set:(($G(%var("DxTeacherViaTraining"))="")||($G(%var("DxTeacherViaTraining"))=$C(0))) %var("DxTeacherViaTraining") = "<null>"

  If (pDimensionsOnly) {
   Set tFactId=""
   Set tIsInsert = 1
  }
  ElseIf (pBatchMode) {
   Set zuSetting = $zu(115,1,0)
   Set tIsInsert = 1
  }
  ElseIf (pID'="") {
   Set tFactId = $O($$$DeepSeeIndexGLVN("FEEDBACKCUBE","%sourceId",pID,""))
   Set tIsInsert = ''(tFactId="")
  }
  ElseIf (pFactId'="") {
   If ($D($$$DeepSeeIndexGLVN("FEEDBACKCUBE","%sourceIdReverse",pFactId))) {
    Set tFactId = pFactId
    Set tIsInsert = 0
   }
   Else {
    Set tFactId = ""
    Set tIsInsert = 1
   }
  }
  Else {
   Set tFactId = ""
   Set tIsInsert = 1
  }

 #; STAR Table: Stc.DeepSee.FeedBackCube.StarCourseViaTraining
 If ($G(%var("DxCourseViaTraining"))'="") {
  Set tStarId = $O(^DeepSee.DimensionI("STC.DEEPSEE.FEEDBACKCUBE.STARCOURSEVIATRAINING","Primary",$zu(28,%var("DxCourseViaTraining"),7,113),""))
  If (tStarId '= "") {
   Set %var("DxCourseViaTraining") = tStarId
  }
  Else {
  Set tLockKey = $zu(28,%var("DxCourseViaTraining"),7,113)
  Lock +$$$DeepSeeIndexGLVN("Stc.DeepSee.FeedBackCube.StarCourseViaTraining",tLockKey):15
  If '$Test {
   Set tSC = $$$ERROR($$$GeneralError,"Unable to acquire lock for dimension table: 'Stc_DeepSee_FeedBackCube.StarCourseViaTraining'")
   Quit
  }
  Set tStarId = $O(^DeepSee.DimensionI("STC.DEEPSEE.FEEDBACKCUBE.STARCOURSEVIATRAINING","Primary",$zu(28,%var("DxCourseViaTraining"),7,113),""))
   If (tStarId '= "") {
    Set %var("DxCourseViaTraining") = tStarId
   }
   Else {
    &sql(INSERT INTO Stc_DeepSee_FeedBackCube.StarCourseViaTraining (DxCourseViaTraining,Dx2997266354) VALUES (:%var("DxCourseViaTraining"),:%var("Dx2997266354")))
    If (SQLCODE'=0) {
     Lock -$$$DeepSeeIndexGLVN("Stc.DeepSee.FeedBackCube.StarCourseViaTraining",tLockKey)
     Set tSC = $$$ERROR($$$GeneralError,"Insert into dimension table failed: 'Stc_DeepSee_FeedBackCube.StarCourseViaTraining' SQLCODE="_SQLCODE)
     Do ..%LogError(tSC)
     Quit
    }
    Set %var("DxCourseViaTraining") = %ROWID
   }
   Lock -$$$DeepSeeIndexGLVN("Stc.DeepSee.FeedBackCube.StarCourseViaTraining",tLockKey)
  }
 }

 #; STAR Table: Stc.DeepSee.FeedBackCube.StarTeacherViaTraining
 If ($G(%var("DxTeacherViaTraining"))'="") {
  Set tStarId = $O(^DeepSee.DimensionI("STC.DEEPSEE.FEEDBACKCUBE.STARTEACHERVIATRAINING","Primary",$zu(28,%var("DxTeacherViaTraining"),7,113),""))
  If (tStarId '= "") {
   Set %var("DxTeacherViaTraining") = tStarId
  }
  Else {
  Set tLockKey = $zu(28,%var("DxTeacherViaTraining"),7,113)
  Lock +$$$DeepSeeIndexGLVN("Stc.DeepSee.FeedBackCube.StarTeacherViaTraining",tLockKey):15
  If '$Test {
   Set tSC = $$$ERROR($$$GeneralError,"Unable to acquire lock for dimension table: 'Stc_DeepSee_FeedBackCube.StarTeacherViaTraining'")
   Quit
  }
  Set tStarId = $O(^DeepSee.DimensionI("STC.DEEPSEE.FEEDBACKCUBE.STARTEACHERVIATRAINING","Primary",$zu(28,%var("DxTeacherViaTraining"),7,113),""))
   If (tStarId '= "") {
    Set %var("DxTeacherViaTraining") = tStarId
   }
   Else {
    &sql(INSERT INTO Stc_DeepSee_FeedBackCube.StarTeacherViaTraining (DxTeacherViaTraining,Dx1346869160) VALUES (:%var("DxTeacherViaTraining"),:%var("Dx1346869160")))
    If (SQLCODE'=0) {
     Lock -$$$DeepSeeIndexGLVN("Stc.DeepSee.FeedBackCube.StarTeacherViaTraining",tLockKey)
     Set tSC = $$$ERROR($$$GeneralError,"Insert into dimension table failed: 'Stc_DeepSee_FeedBackCube.StarTeacherViaTraining' SQLCODE="_SQLCODE)
     Do ..%LogError(tSC)
     Quit
    }
    Set %var("DxTeacherViaTraining") = %ROWID
   }
   Lock -$$$DeepSeeIndexGLVN("Stc.DeepSee.FeedBackCube.StarTeacherViaTraining",tLockKey)
  }
 }
 If ('pBatchMode) {
    Set tVal = %var("DxCourseViaTraining")
    If ((tVal'="")&&('$D($$$DeepSeeIndexGLVN("FEEDBACKCUBE",2,tVal)))) {
     Set ts = $I($$$DeepSeeResultsGLVN("FEEDBACKCUBE","fact",2))
    }
    Set tVal = %var("DxTeacherViaTraining")
    If ((tVal'="")&&('$D($$$DeepSeeIndexGLVN("FEEDBACKCUBE",3,tVal)))) {
     Set ts = $I($$$DeepSeeResultsGLVN("FEEDBACKCUBE","fact",3))
    }
 }
 #; INSERT or UPDATE data into fact table
 If (pDimensionsOnly) {
 }
 ElseIf (pBatchMode) {
  &sql(INSERT %NOLOCK %NOINDEX INTO Stc_DeepSee_FeedBackCube.Fact (%sourceId,DxCourseViaTraining,DxTeacherViaTraining,MxRating)
       VALUES (:pID,:%var("DxCourseViaTraining"),:%var("DxTeacherViaTraining"),:%var("MxRating")))
  Set pFactId = %ROWID
  If (pFactId'="") {
   Set:pID'="" $$$DeepSeeIndexGLVN("FEEDBACKCUBE","%sourceId",pID,pFactId) = ""
   Set $$$DeepSeeIndexGLVN("FEEDBACKCUBE","%sourceIdReverse",pFactId) = pID
  }
 }
 Else {
 If ($G(tFactId)'="") {
  &sql(UPDATE Stc_DeepSee_FeedBackCube.Fact (%sourceId,DxCourseViaTraining,DxTeacherViaTraining,MxRating)
       VALUES (:pID,:%var("DxCourseViaTraining"),:%var("DxTeacherViaTraining"),:%var("MxRating")) WHERE %ID = :tFactId)
  Set pFactId = tFactId
 }
 Else {
  &sql(INSERT INTO Stc_DeepSee_FeedBackCube.Fact (%sourceId,DxCourseViaTraining,DxTeacherViaTraining,MxRating)
       VALUES (:pID,:%var("DxCourseViaTraining"),:%var("DxTeacherViaTraining"),:%var("MxRating")))
  Set pFactId = %ROWID
  If (pFactId'="") {
   Set:pID'="" $$$DeepSeeIndexGLVN("FEEDBACKCUBE","%sourceId",pID,pFactId) = ""
   Set $$$DeepSeeIndexGLVN("FEEDBACKCUBE","%sourceIdReverse",pFactId) = pID
  }
 }
 }
 If (SQLCODE'=0) {
  Set pErrorMsg = $G(%msg)
  Set tSC = $$$ERROR($$$GeneralError,"Error inserting/updating fact: (Source ID:'"_pID_"') "_pErrorMsg)
  Do ..%LogError(tSC)
  Set x = $I($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE"))
  Set $$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",pID) = tSC
 }
 }
 Catch(ex) {
  Set tSC = ex.AsStatus()
  Set pErrorMsg = $ZE
  Do ..%LogError(tSC)
  Set x = $I($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE"))
  Set $$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",pID) = tSC
 }
 Set:$D(zuSetting) zuSetting = $zu(115,1,zuSetting)
 Quit tSC
]]></Implementation>
</Method>

<Method name="%OnStartBatch">
<Description><![CDATA[
Notification that a batch of facts are about to be processed.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pCubeName:%String,pVerbose:%Boolean=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[ Quit $$$OK
]]></Implementation>
</Method>

<Method name="%OnEndBatch">
<Description><![CDATA[
Notification that a batch of facts have just been processed.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pCubeName:%String,pVerbose:%Boolean=0</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[ Quit $$$OK
]]></Implementation>
</Method>

<Method name="%InjectFact">
<Description><![CDATA[
Perform the work of injecting one fact into the cube without associated source data.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[&pFactId:%Integer,&pValues:%String,*pChunks:%Integer,pDimensionsOnly:%Boolean=0]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 New %var,%source,%value
 Set tSC = $$$OK
 Try {
  Set %value=""
  Set %var("MxRating") = $G(pValues("Rating"))
  Set %var("Dx2997266354") = $G(pValues("Training.Course.Name.Value"))
  Set %var("DxCourseViaTraining") = $G(pValues("Training.Course~~EXTERNAL"),$G(pValues("Training.Course")))
  Set %var("Dx1346869160") = $G(pValues("Training.Teacher.LastName.Value"))
  Set %var("DxTeacherViaTraining") = $G(pValues("Training.Teacher~~EXTERNAL"),$G(pValues("Training.Teacher")))

  #; invoke method to process this fact
  Set pFactId = $G(pFactId)
  Set tSC = ##class(Stc.DeepSee.FeedBackCube.Fact).%ProcessFact("",0,.%var,.pFactId,.pErrorMsg,,pDimensionsOnly)
  If $$$ISOK(tSC) {
   Set:(pFactId'="")&&('pDimensionsOnly) pChunks(pFactId\64000+1) = ""
  }
 }
 Catch(ex) {
  Set tSC = ex.AsStatus()
  Do ..%LogError(tSC)
  Set x = $I($$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE"))
  Set $$$DeepSeeBuildErrorsGLVN("FEEDBACKCUBE",pID) = tSC
 }
 Quit tSC
]]></Implementation>
</Method>

<Method name="%DeleteFact">
<Description><![CDATA[
Perform the work of deleting one fact in the cube.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>pID:%String,*pFactId:%Integer,*pErrorMsg:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 Set tSC = $$$OK
 New %ROWID,%msg
 Try {
  Set (SQLCODE,tStarId) = ""
  Set pErrorMsg = ""
  Set pFactId = ""
  Set pFactId = $O($$$DeepSeeIndexGLVN("FEEDBACKCUBE","%sourceId",pID,""))
  If (pFactId'="") {
   &sql(DELETE FROM Stc_DeepSee_FeedBackCube.Fact WHERE %ID = :pFactId)
   Kill $$$DeepSeeIndexGLVN("FEEDBACKCUBE","%sourceId",pID,pFactId)
   Kill $$$DeepSeeIndexGLVN("FEEDBACKCUBE","%sourceIdReverse",pFactId)
  }
 }
 Catch(ex) {
  Set tSC = ex.AsStatus()
  Set pErrorMsg = $ZE
  Do ..%LogError(tSC)
 }
 Quit tSC
]]></Implementation>
</Method>

<Method name="%OnKillFacts">
<Description><![CDATA[
Notification that this cube is being killed.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 Set tSC = $$$OK
 Try {
 }
 Catch(ex) {
  Set tSC = ex.AsStatus()
  Do ..%LogError(tSC)
 }
 Quit tSC
]]></Implementation>
</Method>

<Method name="%PrecomputeAggregates">
<Description><![CDATA[
Pre-compute certain aggregates.<br/>
Generated by %DeepSee.Generator:%CreateFactTable.<br/>
DO NOT CALL THIS METHOD DIRECTLY]]></Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[pStartChunk:%Integer,pEndChunk:%Integer,pAggGLVN:%String,pVerbose:%Boolean=0,pTaskGroup:%String="",&pCount:%Integer=0]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
 Set tSC = $$$OK
 New %ROWID,%msg,%var
 Kill @pAggGLVN
 Try {
  Set (SQLCODE) = ""
  Set tLastCount = 0
 If (pTaskGroup'="") {
  Set tDelta = pCount - tLastCount
  Set inc=$I(^CacheTemp.DeepSeeUpdate($ZU(5),pTaskGroup,"facts"),tDelta)
 }
 }
 Catch(ex) {
  Set tSC = ex.AsStatus()
  Set pErrorMsg = $ZE
  Do ..%LogError(tSC)
 }
 Quit tSC
]]></Implementation>
</Method>

<Storage name="Default">
<Type>%Library.CacheStorage</Type>
<DataLocation>^DeepSee.Fact("STC.DEEPSEE.FEEDBACKCUBE.FACT")</DataLocation>
<DefaultData>FactDefaultData</DefaultData>
<IdLocation>^DeepSee.Fact("STC.DEEPSEE.FEEDBACKCUBE.FACT")</IdLocation>
<IndexLocation>^Stc.DeepSee.FeedBackCube.FactI</IndexLocation>
<StreamLocation>^DeepSee.FactS("STC.DEEPSEE.FEEDBACKCUBE.FACT")</StreamLocation>
<ExtentSize>10000000</ExtentSize>
<Data name="FactDefaultData">
<Structure>listnode</Structure>
<Subscript/>
<Value name="1">
<Value>%sourceId</Value>
</Value>
<Value name="2">
<Value>DxCourseViaTraining</Value>
</Value>
<Value name="3">
<Value>DxTeacherViaTraining</Value>
</Value>
<Value name="4">
<Value>MxRating</Value>
</Value>
</Data>
<Index name="$Fact">
<Location>^DeepSee.Index("FEEDBACKCUBE","$Fact")</Location>
</Index>
<Index name="DxCourseViaTraining">
<Location>^DeepSee.Index("FEEDBACKCUBE",2)</Location>
</Index>
<Index name="DxTeacherViaTraining">
<Location>^DeepSee.Index("FEEDBACKCUBE",3)</Location>
</Index>
<Index name="MxRating">
<Location>^DeepSee.Index("FEEDBACKCUBE","M1")</Location>
</Index>
</Storage>
</Class>
</Export>
